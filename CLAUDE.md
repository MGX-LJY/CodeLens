# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

CodeLens is a Document-Driven MCP (Model Context Protocol) Server designed to collaborate with Claude Code. Instead of autonomously generating documentation, CodeLens provides structured file information, document templates, and validation services that enable Claude Code to efficiently understand and document projects.

## Current State

This repository has been **successfully refactored** from an AI-driven documentation generator to a Claude Code collaboration assistant. The core MCP tools are implemented and tested.

## Core Architecture

CodeLens operates as a **Claude Code collaboration assistant** with three main service layers:

### Service Layer
- **FileService**: Project file scanning, metadata extraction, directory tree generation
- **TemplateService**: Document template management and formatting
- **ValidationService**: Documentation structure validation and status reporting

### MCP Interface Layer
- **doc_scan**: Scans project files and returns structured information
- **template_get**: Provides document templates for various documentation levels
- **doc_verify**: Validates documentation generation status

### Documentation Structure (When Generated by Claude Code)
1. **Architecture Layer** (`/docs/architecture/`) - System overview, design patterns, tech stack
2. **Module Layer** (`/docs/modules/`) - Module functionality, interfaces, dependencies  
3. **File Layer** (`/docs/files/`) - File summaries, classes, functions, algorithms
4. **Project Layer** (`/docs/project/`) - README, changelog, version records

## Tech Stack

- **Primary Language**: Python 3.9+
- **Framework**: MCP (Model Context Protocol)
- **File Processing**: pathlib, glob for efficient file operations
- **Template System**: String formatting with structured metadata
- **Validation**: File existence checking without content reading

## MCP Tools Usage

### doc_scan
**Purpose**: Scan project files and return structured information
```python
# Command line usage
python src/mcp_tools/doc_scan.py /path/to/project --no-content

# MCP parameters
{
  "project_path": "/path/to/project",
  "include_content": true,
  "config": {
    "file_extensions": [".py"],
    "max_file_size": 50000
  }
}
```

### template_get  
**Purpose**: Retrieve document templates
```python
# Get all templates
python src/mcp_tools/template_get.py --list-all

# Get specific template
python src/mcp_tools/template_get.py --template file_summary
```

### doc_verify
**Purpose**: Validate documentation structure
```python
# Check documentation status
python src/mcp_tools/doc_verify.py /path/to/project --type summary
```

## Key Principles

- **Information Provider**: CodeLens provides structured data, Claude Code generates content
- **Template-Driven**: Standardized templates ensure consistent documentation format  
- **Validation-Focused**: Track documentation completeness without reading content
- **MCP-Native**: Designed specifically for MCP protocol integration

## Current Implementation Status

✅ **Completed**:
- FileService with enhanced metadata and directory tree features
- TemplateService with 4 standard document templates
- ValidationService for documentation status checking
- Three MCP tools: doc_scan, template_get, doc_verify
- Comprehensive test suite with 100% pass rate

## File Structure (Current)

```
/src/
├── services/
│   ├── file_service.py      # Project file scanning and metadata
│   ├── validation_service.py # Documentation validation
│   └── __init__.py
├── templates/
│   ├── document_templates.py # Template management
│   └── __init__.py  
├── mcp_tools/
│   ├── doc_scan.py         # Project scanning MCP tool
│   ├── template_get.py     # Template retrieval MCP tool
│   ├── doc_verify.py       # Documentation validation MCP tool
│   └── __init__.py
└── __init__.py
/docs/                      # Existing documentation structure
/test_new_mcp_tools.py     # Comprehensive test suite
```

## Development Guidelines

When using CodeLens with Claude Code:

1. **Use doc_scan first**: Get project structure and file information
2. **Get templates**: Use template_get to retrieve appropriate documentation templates
3. **Generate documentation**: Let Claude Code analyze files and generate documentation using templates
4. **Verify completion**: Use doc_verify to check documentation status and get recommendations

## 每次都要记得把想法生成在文档中