# CodeLens 数据流设计

## 主要数据流向

### 1. 项目扫描数据流 (doc_scan)
```
Claude Code → doc_scan → FileService
     ↓
项目路径 → 文件扫描 → 元数据提取 → 目录树生成
     ↓
结构化数据 → JSON响应 → Claude Code
```

### 2. 模板获取数据流 (template_get)
```
Claude Code → template_get → TemplateService
     ↓
模板查询 → 层级定位 → 模板加载
     ↓ 
架构层/模块层/文件层/项目层模板
     ↓
模板内容 + 元数据 → JSON响应 → Claude Code
```

### 3. 文档验证数据流 (doc_verify)
```
Claude Code → doc_verify → ValidationService
     ↓
目录检查 → 文件存在性验证 → 状态分析
     ↓
验证报告 → JSON响应 → Claude Code
```

### 4. AI协作工作流
```
Claude Code → 项目扫描 → 模板选择 → 文档生成 → 验证完成
     ↓
信息收集 → 模板应用 → 内容创建 → 质量检查
```

## 详细数据流程

### 文件服务流程
1. **输入**: 项目路径、扫描配置
2. **处理**: 文件扫描 → 元数据提取 → 目录树构建
3. **输出**: 项目信息、文件列表、统计数据

### 模板服务流程
1. **输入**: 模板名称、查询类型
2. **处理**: 模板查找 → 内容加载 → 格式化
3. **输出**: 模板内容、元数据、变量列表

### 验证服务流程
1. **输入**: 项目路径、验证类型
2. **处理**: 目录检查 → 状态分析 → 建议生成
3. **输出**: 验证状态、完成度报告

## 数据格式规范
- **输入格式**: JSON参数配置
- **输出格式**: JSON结构化响应
- **模板格式**: Markdown模板文件
- **元数据**: 文件信息、模板属性、验证状态

## 性能考量
- **高效扫描**: pathlib + glob优化文件处理
- **按需加载**: 模板和数据按需获取
- **缓存机制**: 减少重复计算和I/O操作
- **无状态设计**: 每次调用独立执行，提升并发性能