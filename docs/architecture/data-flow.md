
# CodeLens 数据流设计

## 主要数据流向

### 1. 项目扫描数据流 (doc_scan)
```
Claude Code → doc_scan工具 → FileService
                ↓
项目路径 → 文件扫描 → 元数据提取 → 目录树生成
                ↓
结构化数据 → JSON格式化 → 返回响应
                ↓
             日志记录 → 本地日志文件
```

### 2. 模板获取数据流 (template_get)
```
Claude Code → template_get工具 → TemplateService
                ↓
模板查询 → 模板加载 → 变量验证 → 格式化
                ↓
模板内容 → JSON格式化 → 返回响应
                ↓
             日志记录 → 本地日志文件
```

### 3. 文档验证数据流 (doc_verify)
```
Claude Code → doc_verify工具 → ValidationService
                ↓
目录检查 → 文件存在性验证 → 状态分析
                ↓
验证报告 → JSON格式化 → 返回响应
                ↓
             日志记录 → 本地日志文件
```

### 4. 日志系统数据流
```
所有服务操作 → LogManager → 结构化日志格式化
                ↓
异步写入队列 → FileRotator → 文件轮转检查
                ↓
本地日志文件 → 压缩存档 → 磁盘清理
```

## 详细数据流程

### 文件服务数据流
1. **输入**: 项目路径、扫描配置
2. **处理**: 文件扫描 → 过滤排除 → 元数据提取 → 目录树构建
3. **输出**: 项目信息、文件列表、目录树、统计数据
4. **日志**: 操作追踪、性能统计、错误记录

### 模板服务数据流
1. **输入**: 模板名称、查询类型
2. **处理**: 模板查找 → 内容加载 → 变量验证 → 格式化
3. **输出**: 模板内容、元数据、变量列表
4. **日志**: 模板访问记录、操作状态

### 验证服务数据流
1. **输入**: 项目路径、验证类型
2. **处理**: 目录检查 → 文件存在性验证 → 状态分析 → 建议生成
3. **输出**: 验证状态、缺失文件、完成度报告
4. **日志**: 验证操作记录、状态变更

### 日志系统内部流
1. **日志生成**: 各服务生成日志事件
2. **格式化**: JSON结构化格式化
3. **异步处理**: 后台线程处理写入
4. **文件管理**: 轮转、压缩、清理
5. **监控统计**: 操作统计、性能分析
