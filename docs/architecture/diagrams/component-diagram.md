
# CodeLens 组件关系图

## 组件层次结构

```
┌─────────────────────────────────────────────────────────────┐
│                        客户端层                             │
│                      Claude Code                           │
└─────────────────────┬───────────────────────────────────────┘
                      │ MCP 协议通信
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                      接口层                                │
├─────────────────┬─────────────────┬─────────────────────────┤
│   doc_scan      │  template_get   │     doc_verify          │
│ DocScanTool     │ TemplateGetTool │   DocVerifyTool         │
└─────────────────┼─────────────────┼─────────────────────────┘
                  │                 │                     │
                  ▼                 ▼                     ▼
┌─────────────────────────────────────────────────────────────┐
│                      业务层                                │
├──────────────┬──────────────┬──────────────┬─────────────────┤
│ FileService  │TemplateService│ValidationService│LoggingService│
└──────────────┼──────────────┼──────────────┼─────────────────┘
               │              │              │
               ▼              ▼              ▼
┌─────────────────────────────────────────────────────────────┐
│                      基础层                                │
├─────────────────┬─────────────────┬─────────────────────────┤
│   文件系统       │    模板存储      │      日志存储           │
│ Python pathlib  │   内存模板       │   本地文件系统          │
└─────────────────┴─────────────────┴─────────────────────────┘
```

## 详细组件说明

### 1. **MCP 工具组件** - 对外接口层
- **DocScanTool**: 项目文件扫描工具，提供 MCP 接口
- **TemplateGetTool**: 模板获取工具，支持模板查询和格式化
- **DocVerifyTool**: 文档验证工具，检查文档生成状态

### 2. **服务组件** - 核心业务逻辑
- **FileService**: 文件信息服务，负责项目扫描和元数据提取
- **TemplateService**: 模板管理服务，提供文档模板资源
- **ValidationService**: 验证服务，检查文档结构完整性
- **LoggingService**: 日志服务，提供企业级日志管理

### 3. **日志系统组件** - 可观测性基础设施
- **LogManager**: 统一日志管理器，支持结构化日志
- **FileRotator**: 文件轮转器，自动轮转和压缩日志文件
- **LogConfig**: 配置管理器，支持运行时配置更新

### 4. **基础组件** - 底层支撑
- **文件系统接口**: 基于 pathlib 的文件操作
- **模板存储**: 内存中的模板资源管理
- **配置系统**: JSON 配置文件管理

## 组件依赖关系

```
DocScanTool ──────────────→ FileService ──────────→ LoggingService
                                │                        ↑
                                ▼                        │
TemplateGetTool ──────────→ TemplateService ─────────────┘
                                │                        ↑
                                ▼                        │
DocVerifyTool ─────────────→ ValidationService ─────────┘

LoggingService 内部组件关系：
LogManager ───→ FileRotator ───→ 本地文件系统
    │               │
    ▼               ▼
LogConfig ─────→ JSON配置文件
```

### 依赖说明
- **MCP 工具** → **服务层**: 所有 MCP 工具都依赖对应的服务组件
- **服务层** → **日志服务**: 所有服务都集成了日志功能
- **日志服务** → **文件系统**: 日志系统依赖本地文件系统存储
- **服务间无依赖**: FileService、TemplateService、ValidationService 相互独立

## 数据流组件

### 输入处理流
```
Claude Code 请求 → MCP 工具 → 参数验证 → 服务调用
```

### 业务处理流  
```
服务调用 → 业务逻辑 → 数据处理 → 结果生成
```

### 输出处理流
```
结果生成 → JSON 格式化 → MCP 响应 → Claude Code
```

### 日志处理流
```
所有操作 → 日志生成 → 格式化 → 异步写入 → 文件轮转
```
